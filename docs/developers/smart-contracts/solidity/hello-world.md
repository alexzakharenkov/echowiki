# Hello world!

Создадим простой контракт и сохраним его в файл `piggy.sol`.

Этот контракт принимает деньги при создании и выводит их по единице либо все разом, но при этом удаляя себя.

```
pragma solidity ^0.4.24;

contract PiggyBank {
    address owner;
    
    constructor() public payable {
        owner = msg.sender;
    }
    
    function greet() public pure returns (string) {
        return "Hello World!!!";
    }

    function getPennie() public {
        owner.transfer(1);
        emit pennieReturned();
    }

    function breakPiggy() public {
        selfdestruct(owner);
    }

    event pennieReturned();
}
```

Воспользуемся solc чтобы скомпилировать его и вывести получившийся байткод и хэши функций:

```bash
$ ./solc --bin --hashes piggy.sol

======= piggy.sol:PiggyBank =======
Binary: 
6080604052336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550610254806100536000396000f300608060405260043610610057576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680630314c1bf1461005c5780639e19b52d14610073578063cfae32171461008a575b600080fd5b34801561006857600080fd5b5061007161011a565b005b34801561007f57600080fd5b50610088610154565b005b34801561009657600080fd5b5061009f6101eb565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156100df5780820151818401526020810190506100c4565b50505050905090810190601f16801561010c5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16ff5b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc60019081150290604051600060405180830381858888f193505050501580156101bc573d6000803e3d6000fd5b507fbfed43b35c99a41ee9b8cb5a2afa74e45703b17dfd398a3b96260bdebca807cf60405160405180910390a1565b60606040805190810160405280600e81526020017f48656c6c6f20576f726c642121210000000000000000000000000000000000008152509050905600a165627a7a723058202c417e9b0840ebe18e2be5b31caac4edba9cd957395ce053180c3aa9efdd78130029
Function signatures: 
0314c1bf: breakPiggy()
9e19b52d: getPennie()
cfae3217: greet()
```

Создаем контракт от имени nathan с помощью команды `create_contract`, подробности можно узнать в разделе Deploy contract operation.

При создании контракта мы отправляем ему 10000 ECHO
```
create_contract nathan "6080604052336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550610254806100536000396000f300608060405260043610610057576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680630314c1bf1461005c5780639e19b52d14610073578063cfae32171461008a575b600080fd5b34801561006857600080fd5b5061007161011a565b005b34801561007f57600080fd5b50610088610154565b005b34801561009657600080fd5b5061009f6101eb565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156100df5780820151818401526020810190506100c4565b50505050905090810190601f16801561010c5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16ff5b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc60019081150290604051600060405180830381858888f193505050501580156101bc573d6000803e3d6000fd5b507fbfed43b35c99a41ee9b8cb5a2afa74e45703b17dfd398a3b96260bdebca807cf60405160405180910390a1565b60606040805190810160405280600e81526020017f48656c6c6f20576f726c642121210000000000000000000000000000000000008152509050905600a165627a7a723058202c417e9b0840ebe18e2be5b31caac4edba9cd957395ce053180c3aa9efdd78130029" 10000 ECHO 1 2000000 "" true true false
```

После добавления получившейся транзакции в чейн, мы можем узнать идентификатор нашего нового контракта.

Для этого нужно получить результат выполнения контракта. Узнать идентификатор результата можно с помощью метода `get_account_history`, запросив последнюю операцию.
```
unlocked >>> get_account_history nathan 1
get_account_history nathan 1
2039-01-01T15:17:26 create_contract_operation nathan fee: 0.00013 ECHO   result: 1.17.0 
```

Результат создания контракта имеет идентификатор `1.17.0`, теперь получаем его с помощью метода `get_contract_result`.
```
unlocked >>> get_contract_result 1.17.0
get_contract_result 1.17.0
[
  0,{
    "exec_res": {
      "excepted": "None",
      "new_address": "0100000000000000000000000000000000000000",
      "output": "608060405260043610610057576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680630314c1bf1461005c5780639e19b52d14610073578063cfae32171461008a575b600080fd5b34801561006857600080fd5b5061007161011a565b005b34801561007f57600080fd5b50610088610154565b005b34801561009657600080fd5b5061009f6101eb565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156100df5780820151818401526020810190506100c4565b50505050905090810190601f16801561010c5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16ff5b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc60019081150290604051600060405180830381858888f193505050501580156101bc573d6000803e3d6000fd5b507fbfed43b35c99a41ee9b8cb5a2afa74e45703b17dfd398a3b96260bdebca807cf60405160405180910390a1565b60606040805190810160405280600e81526020017f48656c6c6f20576f726c642121210000000000000000000000000000000000008152509050905600a165627a7a723058202c417e9b0840ebe18e2be5b31caac4edba9cd957395ce053180c3aa9efdd78130029",
      "code_deposit": "Success",
      "gas_refunded": 0,
      "gas_for_deposit": 1885669,
      "deposit_size": 596
    },
    "tr_receipt": {
      "status_code": 1,
      "gas_used": 233531,
      "bloom": "00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
      "log": []
    }
  }
]
```

Адрес нового контракта находится в поле `exec_res.new_address`. Он записан в формате адреса Ethereum, в нашем случае это `0100000000000000000000000000000000000000`, что конвертируется в идентификаторы Echo как `1.16.0`.

Теперь, мы можем узнать текущий баланс контракта, а также вызвать его методы.

Узнаем его баланс с помощью метода `list_id_balances`:
```
unlocked >>> list_id_balances 1.16.0
list_id_balances 1.16.0
[{
    "amount": 10000,
    "asset_id": "1.3.0"
  }
]
```

Вызовем метод `greet`, возвращающий константную строку.
```
call_contract nathan 1.16.0 "cfae3217" 0 ECHO 1 2000000 true true
```
Строка, которую вернул контракт, находится в поле результата контракта `exec_res.output` в hex-виде.
```
unlocked >>> get_contract_result 1.17.1
get_contract_result 1.17.1
[
  0,{
    "exec_res": {
      "excepted": "None",
      "new_address": "0000000000000000000000000000000000000000",
      "output": "0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000e48656c6c6f20576f726c64212121000000000000000000000000000000000000",
      "code_deposit": "None",
      "gas_refunded": 0,
      "gas_for_deposit": 0,
      "deposit_size": 0
    },
    "tr_receipt": {
      "status_code": 1,
      "gas_used": 21921,
      "bloom": "00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
      "log": []
    }
  }
]

```

Вызовем метод `getPennie`, производящий трансфер на наш аккаунт и создающий ивент.
```
call_contract nathan 1.16.0 "9e19b52d" 0 ECHO 1 2000000 true true
```

Результатом выполнения этого метода баланс контракта должен был уменьшиться на 1, что мы и видим при просмотре его баланса.
```
unlocked >>> list_id_balances 1.16.0
list_id_balances 1.16.0
[{
    "amount": 9999,
    "asset_id": "1.3.0"
  }
]
```

Также в логах резульAта есть запись о событии.
```
"log": [{
    "address": "0100000000000000000000000000000000000000",
    "log": [
    "bfed43b35c99a41ee9b8cb5a2afa74e45703b17dfd398a3b96260bdebca807cf"
    ],
    "data": ""
}
]
```

Вызовем метод `breakPiggy`, возвращающий все деньги контракта обратно нам и уничтожающий сам контракт.
```
call_contract nathan 1.16.0 "0314c1bf" 0 ECHO 1 2000000 true true
```

В результате мы видим, что баланс контракта уменьшился до нуля, а при просмотре объекта контракта отмечено, что он `suicided` и больше вызывать его методы мы не можем.
```
unlocked >>> list_id_balances 1.16.0
list_id_balances 1.16.0
[{
    "amount": 0,
    "asset_id": "1.3.0"
  }
]

unlocked >>> get_object 1.16.0
get_object 1.16.0
[{
    "id": "1.16.0",
    "statistics": "2.20.0",
    "suicided": true,
    "type": "evm"
  }
]
```