# Общее описание

## Архитектура виртуальных машин ECHO

Предполагается поддержка в **ECHO** несколько виртуальных машин. На данный момент это виртуальная машина **Ethereum** и виртуальная машина **x86**.

Для унификации работы с существующими и подключения перспективных виртуальных машин разработана данная архитектура работы с виртуальными машинами со стороны системы **ECHO**.

### Общая схема работы VMs

Каждая виртуальная машина поддерживает три основные логические операции:

* создание контракта
* выполнение метода контракта
* удаление контракта

Также реализация виртуальной машины должна поддерживать следующие вспомогательные операции:

* конвертация идентификаторов ECHO в формат виртуальной машины и обратно
* конвертация набора параметров из JSON строки в формат виртуальной машины и обратно
* проверка кода контракта \(и, опционально, идентификатора метода контракта\) на соответствие формату данной виртуальной машины

Инициализация виртуальной машины происходит с помощью следущих параметров:

* хэш состояния виртуальной машины
* указатель на абстрактный интерфейс реализации NoSQL БД
* указатель на абстрактный интерфейс доступа к Blockchain БД

### Операции с виртуальной машиной

При работе с виртуальной машиной, в каждую операцию передается контекст,
содержащий следующие параметры:

* индетификатор аккаунта, производящего операцию
* идентификатор передаваемого в операцию актива (asset_id)
* количество передаваемого актива
* ...

Дополнительные параметры операций приведены ниже.

### Создание контракта

### Выполнение контракта

### Удаление контракта

### Результат выполнения операции (создание/выполнение/удаление)

### Хэши состояния машины

### Хранение кода контрактов

### Хранение состояния контрактов

### Работа с газом

### Работа с blockchain из кода контракта